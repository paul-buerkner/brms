<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Moment matching for efficient approximate leave-one-out cross-validation — loo_moment_match.brmsfit • brms</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Moment matching for efficient approximate leave-one-out cross-validation — loo_moment_match.brmsfit"><meta name="description" content="Moment matching for efficient approximate leave-one-out cross-validation
(LOO-CV). See loo_moment_match
for more details."><meta property="og:description" content="Moment matching for efficient approximate leave-one-out cross-validation
(LOO-CV). See loo_moment_match
for more details."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brms</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.22.12</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/brms_customfamilies.html">Define Custom Response Distributions with brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_distreg.html">Estimating Distributional Models with brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_families.html">Parameterization of Response Distributions in brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_missings.html">Handle Missing Values with brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_monotonic.html">Estimating Monotonic Effects with brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_multivariate.html">Estimating Multivariate Models with brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_nonlinear.html">Estimating Non-Linear Models with brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_phylogenetics.html">Estimating Phylogenetic Multilevel Models with brms</a></li>
    <li><a class="dropdown-item" href="../articles/brms_threading.html">Running brms models with within-chain parallelization</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/paul-buerkner/brms/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Moment matching for efficient approximate leave-one-out cross-validation</h1>
      <small class="dont-index">Source: <a href="https://github.com/paul-buerkner/brms/blob/HEAD/R/loo_moment_match.R" class="external-link"><code>R/loo_moment_match.R</code></a></small>
      <div class="d-none name"><code>loo_moment_match.brmsfit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Moment matching for efficient approximate leave-one-out cross-validation
(LOO-CV). See <code><a href="https://mc-stan.org/loo/reference/loo_moment_match.html" class="external-link">loo_moment_match</a></code>
for more details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'brmsfit'</span></span>
<span><span class="fu">loo_moment_match</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  loo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k_threshold <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  resp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  recompile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'loo'</span></span>
<span><span class="fu">loo_moment_match</span><span class="op">(</span><span class="va">x</span>, <span class="va">fit</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An <span style="R">R</span> object of class <code>brmsfit</code> or <code>loo</code> depending
on the method.</p></dd>


<dt id="arg-loo">loo<a class="anchor" aria-label="anchor" href="#arg-loo"></a></dt>
<dd><p>An <span style="R">R</span> object of class <code>loo</code>. If <code>NULL</code>,
brms will try to extract a precomputed <code>loo</code> object
from the fitted model, added there via <code><a href="add_criterion.html">add_criterion</a></code>.</p></dd>


<dt id="arg-k-threshold">k_threshold<a class="anchor" aria-label="anchor" href="#arg-k-threshold"></a></dt>
<dd><p>The Pareto \(k\) threshold for which observations
moment matching is applied. Defaults to <code>0.7</code>.
See <code><a href="https://mc-stan.org/loo/reference/pareto-k-diagnostic.html" class="external-link">pareto_k_ids</a></code>
for more details.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>An optional data.frame for which to evaluate predictions. If
<code>NULL</code> (default), the original data of the model is used. <code>NA</code>
values within factors (excluding grouping variables) are interpreted as if
all dummy variables of this factor are zero. This allows, for instance, to
make predictions of the grand mean when using sum coding. <code>NA</code> values
within grouping variables are treated as a new level.</p></dd>


<dt id="arg-resp">resp<a class="anchor" aria-label="anchor" href="#arg-resp"></a></dt>
<dd><p>Optional names of response variables. If specified, predictions
are performed only for the specified response variables.</p></dd>


<dt id="arg-check">check<a class="anchor" aria-label="anchor" href="#arg-check"></a></dt>
<dd><p>Logical; If <code>TRUE</code> (the default), some checks
check are performed if the <code>loo</code> object was generated
from the <code>brmsfit</code> object passed to argument <code>fit</code>.</p></dd>


<dt id="arg-recompile">recompile<a class="anchor" aria-label="anchor" href="#arg-recompile"></a></dt>
<dd><p>Logical, indicating whether the Stan model should be
recompiled. This may be necessary if you are running moment matching on
another machine than the one used to fit the model. No recompilation
is done by default.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to the underlying methods.
Additional arguments initially passed to <code><a href="loo.brmsfit.html">loo</a></code>,
for example, <code>newdata</code> or <code>resp</code> need to be passed
again to <code>loo_moment_match</code> in order for the latter
to work correctly.</p></dd>


<dt id="arg-fit">fit<a class="anchor" aria-label="anchor" href="#arg-fit"></a></dt>
<dd><p>An <span style="R">R</span> object of class <code>brmsfit</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated object of class <code>loo</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The moment matching algorithm requires draws of all variables
  defined in Stan's <code>parameters</code> block to be saved. Otherwise
  <code>loo_moment_match</code> cannot be computed. Thus, please set
  <code>save_pars = save_pars(all = TRUE)</code> in the call to <code><a href="brm.html">brm</a></code>,
  if you are planning to apply <code>loo_moment_match</code> to your models.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Paananen, T., Piironen, J., Buerkner, P.-C., Vehtari, A. (2021).
  Implicitly Adaptive Importance Sampling. Statistics and Computing.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="brm.html">brm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">zAge</span> <span class="op">+</span> <span class="va">zBase</span> <span class="op">*</span> <span class="va">Trt</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            data <span class="op">=</span> <span class="va">epilepsy</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            save_pars <span class="op">=</span> <span class="fu"><a href="save_pars.html">save_pars</a></span><span class="op">(</span>all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># throws warning about some pareto k estimates being too high</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">loo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="loo.brmsfit.html">loo</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># no more warnings after moment matching</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">mmloo1</span> <span class="op">&lt;-</span> <span class="fu">loo_moment_match</span><span class="op">(</span><span class="va">fit1</span>, loo <span class="op">=</span> <span class="va">loo1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

