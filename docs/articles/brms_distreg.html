<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Distributional Models with brms • brms</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Distributional Models with brms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.22.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred" class="external-link">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>

  </a>
</li>
<li>
  <a href="https://github.com/paul-buerkner/brms" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating Distributional Models with brms</h1>
                        <h4 data-toc-skip class="author">Paul
Bürkner</h4>
            
            <h4 data-toc-skip class="date">2024-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paul-buerkner/brms/blob/HEAD/vignettes/brms_distreg.Rmd" class="external-link"><code>vignettes/brms_distreg.Rmd</code></a></small>
      <div class="hidden name"><code>brms_distreg.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides an introduction on how to fit distributional
regression models with <strong>brms</strong>. We use the term
<em>distributional model</em> to refer to a model, in which we can
specify predictor terms for all parameters of the assumed response
distribution. In the vast majority of regression model implementations,
only the location parameter (usually the mean) of the response
distribution depends on the predictors and corresponding regression
parameters. Other parameters (e.g., scale or shape parameters) are
estimated as auxiliary parameters assuming them to be constant across
observations. This assumption is so common that most researchers
applying regression models are often (in my experience) not aware of the
possibility of relaxing it. This is understandable insofar as relaxing
this assumption drastically increase model complexity and thus makes
models hard to fit. Fortunately, <strong>brms</strong> uses
<strong>Stan</strong> on the backend, which is an incredibly flexible
and powerful tool for estimating Bayesian models so that model
complexity is much less of an issue.</p>
<p>Suppose we have a normally distributed response variable. Then, in
basic linear regression, we specify a predictor term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>η</mi><mi>μ</mi></msub><annotation encoding="application/x-tex">\eta_{\mu}</annotation></semantics></math>
for the mean parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
of the normal distribution. The second parameter of the normal
distribution – the residual standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
– is assumed to be constant across observations. We estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
but do not try to <em>predict</em> it. In a distributional model,
however, we do exactly this by specifying a predictor term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>η</mi><mi>σ</mi></msub><annotation encoding="application/x-tex">\eta_{\sigma}</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
in addition to the predictor term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>η</mi><mi>μ</mi></msub><annotation encoding="application/x-tex">\eta_{\mu}</annotation></semantics></math>.
Ignoring group-level effects for the moment, the linear predictor of a
parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
for observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
has the form</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>η</mi><mrow><mi>θ</mi><mi>n</mi></mrow></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>K</mi><mi>θ</mi></msub></munderover><msub><mi>b</mi><mrow><mi>θ</mi><mi>i</mi></mrow></msub><msub><mi>x</mi><mrow><mi>θ</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\eta_{\theta n} = \sum_{i = 1}^{K_{\theta}} b_{\theta i} x_{\theta i n}</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mrow><mi>θ</mi><mi>i</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">x_{\theta i n}</annotation></semantics></math>
denotes the value of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
predictor of parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
for observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mrow><mi>θ</mi><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">b_{\theta i}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
regression coefficient of parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>.
A distributional normal model with response variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
can then be written as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>n</mi></msub><mo>∼</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>η</mi><mrow><mi>μ</mi><mi>n</mi></mrow></msub><mo>,</mo><mspace width="0.167em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>η</mi><mrow><mi>σ</mi><mi>n</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_n \sim \mathcal{N}\left(\eta_{\mu n}, \, \exp(\eta_{\sigma n}) \right)</annotation></semantics></math>
We used the exponential function around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>η</mi><mi>σ</mi></msub><annotation encoding="application/x-tex">\eta_{\sigma}</annotation></semantics></math>
to reflect that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
constitutes a standard deviation and thus only takes on positive values,
while a linear predictor can be any real number.</p>
</div>
<div class="section level2">
<h2 id="a-simple-distributional-model">A simple distributional model<a class="anchor" aria-label="anchor" href="#a-simple-distributional-model"></a>
</h2>
<p>Unequal variance models are possibly the most simple, but
nevertheless very important application of distributional models.
Suppose we have two groups of patients: One group receives a treatment
(e.g., an antidepressive drug) and another group receives placebo. Since
the treatment may not work equally well for all patients, the symptom
variance of the treatment group may be larger than the symptom variance
of the placebo group after some weeks of treatment. For simplicity,
assume that we only investigate the post-treatment values.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"treat"</span>, <span class="st">"placebo"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">symptom_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">symptom_post</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">)</span></span></code></pre></div>
<pre><code>  group symptom_post
1 treat   -1.8000870
2 treat    1.5106341
3 treat   -3.8745272
4 treat    0.9888574
5 treat    2.2431054
6 treat    3.2968232</code></pre>
<p>The following model estimates the effect of <code>group</code> on
both the mean and the residual standard deviation of the normal response
distribution.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm.html">brm</a></span><span class="op">(</span><span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">symptom_post</span> <span class="op">~</span> <span class="va">group</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="va">group</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dat1</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Useful summary statistics and plots can be obtained via</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit1</span>, N <span class="op">=</span> <span class="fl">2</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_distreg_files/figure-html/unnamed-chunk-3-1.png" width="60%" style="display: block; margin: auto;"><img src="brms_distreg_files/figure-html/unnamed-chunk-3-2.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/conditional_effects.brmsfit.html">conditional_effects</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span>, points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_distreg_files/figure-html/unnamed-chunk-3-3.png" width="60%" style="display: block; margin: auto;"></p>
<p>The population-level effect <code>sigma_grouptreat</code>, which is
the contrast of the two residual standard deviations on the log-scale,
reveals that the variances of both groups are indeed different. This
impression is confirmed when looking at the
<code>conditional_effects</code> of <code>group</code>. Going one step
further, we can compute the residual standard deviations on the original
scale using the <code>hypothesis</code> method.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hyp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp(sigma_Intercept) = 0"</span>,</span>
<span>         <span class="st">"exp(sigma_Intercept + sigma_grouptreat) = 0"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hypothesis.brmsfit.html">hypothesis</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">hyp</span><span class="op">)</span></span></code></pre></div>
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
1 (exp(sigma_Interc... = 0     1.11      0.15     0.86     1.46         NA        NA    *
2 (exp(sigma_Interc... = 0     2.23      0.30     1.73     2.92         NA        NA    *
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<p>We may also directly compare them and plot the posterior distribution
of their difference.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hyp</span> <span class="op">&lt;-</span> <span class="st">"exp(sigma_Intercept + sigma_grouptreat) &gt; exp(sigma_Intercept)"</span></span>
<span><span class="op">(</span><span class="va">hyp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hypothesis.brmsfit.html">hypothesis</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">hyp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
1 (exp(sigma_Interc... &gt; 0     1.11      0.34      0.6     1.72        Inf         1    *
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hyp</span>, chars <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_distreg_files/figure-html/unnamed-chunk-5-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>Indeed, the residual standard deviation of the treatment group seems
to larger than that of the placebo group. Moreover the magnitude of this
difference is pretty similar to what we expected due to the values we
put into the data simulations.</p>
</div>
<div class="section level2">
<h2 id="zero-inflated-models">Zero-Inflated Models<a class="anchor" aria-label="anchor" href="#zero-inflated-models"></a>
</h2>
<p>Another important application of the distributional regression
framework are so called zero-inflated models. These models are helpful
whenever there are more zeros in the response variable than one would
naturally expect. For example, if one seeks to predict the number of
cigarettes people smoke per day and also includes non-smokers, there
will be a huge amount of zeros which, when not modeled appropriately,
can seriously distort parameter estimates. Here, we consider an example
dealing with the number of fish caught by various groups of people. On
the UCLA website (), the data are described as follows: “The state
wildlife biologists want to model how many fish are being caught by
fishermen at a state park. Visitors are asked how long they stayed, how
many people were in the group, were there children in the group and how
many fish were caught. Some visitors do not fish, but there is no data
on whether a person fished or not. Some visitors who did fish did not
catch any fish so there are excess zeros in the data because of the
people that did not fish.”</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zinb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://paul-buerkner.github.io/data/fish.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">zinb</span><span class="op">)</span></span></code></pre></div>
<pre><code>  nofish livebait camper persons child         xb         zg count
1      1        0      0       1     0 -0.8963146  3.0504048     0
2      0        1      1       1     0 -0.5583450  1.7461489     0
3      0        1      0       1     0 -0.4017310  0.2799389     0
4      0        1      1       2     1 -0.9562981 -0.6015257     0
5      0        1      0       1     0  0.4368910  0.5277091     1
6      0        1      1       4     2  1.3944855 -0.7075348     0</code></pre>
<p>As predictors we choose the number of people per group, the number of
children, as well as whether the group consists of campers. Many groups
may not even try catching any fish at all (thus leading to many zero
responses) and so we fit a zero-inflated Poisson model to the data. For
now, we assume a constant zero-inflation probability across
observations.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_zinb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm.html">brm</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">persons</span> <span class="op">+</span> <span class="va">child</span> <span class="op">+</span> <span class="va">camper</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">zinb</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/brmsfamily.html">zero_inflated_poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Again, we summarize the results using the usual methods.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_zinb1</span><span class="op">)</span></span></code></pre></div>
<pre><code> Family: zero_inflated_poisson 
  Links: mu = log; zi = identity 
Formula: count ~ persons + child + camper 
   Data: zinb (Number of observations: 250) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -1.01      0.18    -1.36    -0.67 1.00     2676     2550
persons       0.88      0.05     0.78     0.96 1.00     2728     2726
child        -1.36      0.10    -1.55    -1.17 1.00     2518     2520
camper        0.80      0.09     0.62     0.98 1.00     3228     2871

Further Distributional Parameters:
   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
zi     0.41      0.05     0.32     0.49 1.00     2879     2371

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/conditional_effects.brmsfit.html">conditional_effects</a></span><span class="op">(</span><span class="va">fit_zinb1</span><span class="op">)</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_distreg_files/figure-html/unnamed-chunk-8-1.png" width="60%" style="display: block; margin: auto;"><img src="brms_distreg_files/figure-html/unnamed-chunk-8-2.png" width="60%" style="display: block; margin: auto;"><img src="brms_distreg_files/figure-html/unnamed-chunk-8-3.png" width="60%" style="display: block; margin: auto;"></p>
<p>According to the parameter estimates, larger groups catch more fish,
campers catch more fish than non-campers, and groups with more children
catch less fish. The zero-inflation probability <code>zi</code> is
pretty large with a mean of 41%. Please note that the probability of
catching no fish is actually higher than 41%, but parts of this
probability are already modeled by the Poisson distribution itself
(hence the name zero-<em>inflation</em>). If you want to treat all zeros
as originating from a separate process, you can use hurdle models
instead (not shown here).</p>
<p>Now, we try to additionally predict the zero-inflation probability by
the number of children. The underlying reasoning is that we expect
groups with more children to not even try catching fish. Most children
are just terribly bad at waiting for hours until something happens. From
a purely statistical perspective, zero-inflated (and hurdle)
distributions are a mixture of two processes and predicting both parts
of the model is natural and often very reasonable to make full use of
the data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_zinb2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm.html">brm</a></span><span class="op">(</span><span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">persons</span> <span class="op">+</span> <span class="va">child</span> <span class="op">+</span> <span class="va">camper</span>, <span class="va">zi</span> <span class="op">~</span> <span class="va">child</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">zinb</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/brmsfamily.html">zero_inflated_poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_zinb2</span><span class="op">)</span></span></code></pre></div>
<pre><code> Family: zero_inflated_poisson 
  Links: mu = log; zi = logit 
Formula: count ~ persons + child + camper 
         zi ~ child
   Data: zinb (Number of observations: 250) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept       -1.08      0.18    -1.44    -0.73 1.00     3080     2553
zi_Intercept    -0.96      0.27    -1.54    -0.48 1.00     3741     2183
persons          0.89      0.05     0.80     0.99 1.00     3083     2610
child           -1.18      0.10    -1.37    -0.99 1.00     3227     2605
camper           0.78      0.09     0.59     0.96 1.00     3795     2842
zi_child         1.23      0.28     0.69     1.79 1.00     3783     2305

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/conditional_effects.brmsfit.html">conditional_effects</a></span><span class="op">(</span><span class="va">fit_zinb2</span><span class="op">)</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_distreg_files/figure-html/unnamed-chunk-10-1.png" width="60%" style="display: block; margin: auto;"><img src="brms_distreg_files/figure-html/unnamed-chunk-10-2.png" width="60%" style="display: block; margin: auto;"><img src="brms_distreg_files/figure-html/unnamed-chunk-10-3.png" width="60%" style="display: block; margin: auto;"></p>
<p>To transform the linear predictor of <code>zi</code> into a
probability, <strong>brms</strong> applies the logit-link:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>z</mi><mi>i</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>z</mi><mi>i</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>η</mi><mrow><mi>z</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">logit(zi) = \log\left(\frac{zi}{1-zi}\right) = \eta_{zi}</annotation></semantics></math></p>
<p>The logit-link takes values within
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0, 1]</annotation></semantics></math>
and returns values on the real line. Thus, it allows the transition
between probabilities and linear predictors.</p>
<p>According to the model, trying to fish with children not only
decreases the overall number fish caught (as implied by the Poisson part
of the model) but also drastically increases your change of catching no
fish at all (as implied by the zero-inflation part) most likely because
groups with more children are not even trying.</p>
</div>
<div class="section level2">
<h2 id="additive-distributional-models">Additive Distributional Models<a class="anchor" aria-label="anchor" href="#additive-distributional-models"></a>
</h2>
<p>In the examples so far, we did not have multilevel data and thus did
not fully use the capabilities of the distributional regression
framework of <strong>brms</strong>. In the example presented below, we
will not only show how to deal with multilevel data in distributional
models, but also how to incorporate smooth terms (i.e., splines) into
the model. In many applications, we have no or only a very vague idea
how the relationship between a predictor and the response looks like. A
very flexible approach to tackle this problems is to use splines and let
them figure out the form of the relationship. For illustration purposes,
we simulate some data with the <strong>mgcv</strong> package, which is
also used in <strong>brms</strong> to prepare smooth terms.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_smooth</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html" class="external-link">gamSim</a></span><span class="op">(</span>eg <span class="op">=</span> <span class="fl">6</span>, n <span class="op">=</span> <span class="fl">200</span>, scale <span class="op">=</span> <span class="fl">2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>Gu &amp; Wahba 4 term additive model</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_smooth</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>         y         x0        x1        x2         x3         f
1 12.92273 0.96651135 0.3691115 0.3593699 0.78460188 10.884529
2 18.40754 0.22727652 0.4963649 0.1955503 0.68744329 18.496395
3 21.93221 0.78123327 0.6837480 0.2265349 0.46031478 23.106494
4 16.81739 0.30480938 0.1792808 0.8136442 0.58074895 15.933849
5  8.52869 0.72356461 0.1101498 0.7070212 0.02468504  8.580855
6 10.46097 0.04443954 0.5292058 0.7566186 0.39524938 11.097018</code></pre>
<p>The data contains the predictors <code>x0</code> to <code>x3</code>
as well as the grouping factor <code>fac</code> indicating the nested
structure of the data. We predict the response variable <code>y</code>
using smooth terms of <code>x1</code> and <code>x2</code> and a varying
intercept of <code>fac</code>. In addition, we assume the residual
standard deviation <code>sigma</code> to vary by a smoothing term of
<code>x0</code> and a varying intercept of <code>fac</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_smooth1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm.html">brm</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/s.html">s</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/s.html">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">fac</span><span class="op">)</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="fu"><a href="../reference/s.html">s</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">fac</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat_smooth</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_smooth1</span><span class="op">)</span></span></code></pre></div>
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = log 
Formula: y ~ s(x1) + s(x2) + (1 | fac) 
         sigma ~ s(x0) + (1 | fac)
   Data: dat_smooth (Number of observations: 200) 
  Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 2000

Smoothing Spline Hyperparameters:
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sds(sx1_1)           2.17      1.47     0.29     5.99 1.00      872      748
sds(sx2_1)          17.80      5.24    10.48    31.11 1.00      655     1014
sds(sigma_sx0_1)     0.87      0.81     0.04     3.12 1.00      715      957

Multilevel Hyperparameters:
~fac (Number of levels: 4) 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)           4.71      2.13     2.19     9.47 1.00      696      932
sd(sigma_Intercept)     0.14      0.17     0.00     0.62 1.00      735      826

Regression Coefficients:
                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept          15.70      2.18    11.62    20.32 1.00      665     1001
sigma_Intercept     0.76      0.11     0.55     0.98 1.00     1117      733
sx1_1               9.31      4.45     0.90    18.59 1.00     1105     1053
sx2_1              37.73     14.52    10.51    67.31 1.00     1367     1243
sigma_sx0_1         0.35      1.92    -3.66     4.23 1.00     1294      749

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/conditional_effects.brmsfit.html">conditional_effects</a></span><span class="op">(</span><span class="va">fit_smooth1</span><span class="op">)</span>, points <span class="op">=</span> <span class="cn">TRUE</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_distreg_files/figure-html/unnamed-chunk-13-1.png" width="60%" style="display: block; margin: auto;"><img src="brms_distreg_files/figure-html/unnamed-chunk-13-2.png" width="60%" style="display: block; margin: auto;"><img src="brms_distreg_files/figure-html/unnamed-chunk-13-3.png" width="60%" style="display: block; margin: auto;"></p>
<p>This model is likely an overkill for the data at hand, but nicely
demonstrates the ease with which one can specify complex models with
<strong>brms</strong> and to fit them using <strong>Stan</strong> on the
backend.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
