<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Multivariate Models with brms • brms</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Multivariate Models with brms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.22.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred" class="external-link">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>

  </a>
</li>
<li>
  <a href="https://github.com/paul-buerkner/brms" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating Multivariate Models with brms</h1>
                        <h4 data-toc-skip class="author">Paul
Bürkner</h4>
            
            <h4 data-toc-skip class="date">2024-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paul-buerkner/brms/blob/HEAD/vignettes/brms_multivariate.Rmd" class="external-link"><code>vignettes/brms_multivariate.Rmd</code></a></small>
      <div class="hidden name"><code>brms_multivariate.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In the present vignette, we want to discuss how to specify
multivariate multilevel models using <strong>brms</strong>. We call a
model <em>multivariate</em> if it contains multiple response variables,
each being predicted by its own set of predictors. Consider an example
from biology. Hadfield, Nutall, Osorio, and Owens (2007) analyzed data
of the Eurasian blue tit (<a href="https://en.wikipedia.org/wiki/Eurasian_blue_tit" class="external-link uri">https://en.wikipedia.org/wiki/Eurasian_blue_tit</a>). They
predicted the <code>tarsus</code> length as well as the
<code>back</code> color of chicks. Half of the brood were put into
another <code>fosternest</code>, while the other half stayed in the
fosternest of their own <code>dam</code>. This allows to separate
genetic from environmental factors. Additionally, we have information
about the <code>hatchdate</code> and <code>sex</code> of the chicks (the
latter being known for 94% of the animals).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"BTdata"</span>, package <span class="op">=</span> <span class="st">"MCMCglmm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">BTdata</span><span class="op">)</span></span></code></pre></div>
<pre><code>       tarsus       back  animal     dam fosternest  hatchdate  sex
1 -1.89229718  1.1464212 R187142 R187557      F2102 -0.6874021  Fem
2  1.13610981 -0.7596521 R187154 R187559      F1902 -0.6874021 Male
3  0.98468946  0.1449373 R187341 R187568       A602 -0.4279814 Male
4  0.37900806  0.2555847 R046169 R187518      A1302 -1.4656641 Male
5 -0.07525299 -0.3006992 R046161 R187528      A2602 -1.4656641  Fem
6 -1.13519543  1.5577219 R187409 R187945      C2302  0.3502805  Fem</code></pre>
</div>
<div class="section level2">
<h2 id="basic-multivariate-models">Basic Multivariate Models<a class="anchor" aria-label="anchor" href="#basic-multivariate-models"></a>
</h2>
<p>We begin with a relatively simple multivariate normal model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bform1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="fu"><a href="../reference/mvbind.html">mvbind</a></span><span class="op">(</span><span class="va">tarsus</span>, <span class="va">back</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">hatchdate</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">p</span><span class="op">|</span><span class="va">fosternest</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">q</span><span class="op">|</span><span class="va">dam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm.html">brm</a></span><span class="op">(</span><span class="va">bform1</span>, data <span class="op">=</span> <span class="va">BTdata</span>, chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>As can be seen in the model code, we have used <code>mvbind</code>
notation to tell <strong>brms</strong> that both <code>tarsus</code> and
<code>back</code> are separate response variables. The term
<code>(1|p|fosternest)</code> indicates a varying intercept over
<code>fosternest</code>. By writing <code>|p|</code> in between we
indicate that all varying effects of <code>fosternest</code> should be
modeled as correlated. This makes sense since we actually have two model
parts, one for <code>tarsus</code> and one for <code>back</code>. The
indicator <code>p</code> is arbitrary and can be replaced by other
symbols that comes into your mind (for details about the multilevel
syntax of <strong>brms</strong>, see <code><a href="../reference/brmsformula.html">help("brmsformula")</a></code>
and <code>vignette("brms_multilevel")</code>). Similarly, the term
<code>(1|q|dam)</code> indicates correlated varying effects of the
genetic mother of the chicks. Alternatively, we could have also modeled
the genetic similarities through pedigrees and corresponding relatedness
matrices, but this is not the focus of this vignette (please see
<code><a href="../articles/brms_phylogenetics.html">vignette("brms_phylogenetics")</a></code>). The model results are
readily summarized via</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_criterion.html">add_criterion</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="st">"loo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: tarsus ~ sex + hatchdate + (1 | p | fosternest) + (1 | q | dam) 
         back ~ sex + hatchdate + (1 | p | fosternest) + (1 | q | dam) 
   Data: BTdata (Number of observations: 828) 
  Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 2000

Multilevel Hyperparameters:
~dam (Number of levels: 106) 
                                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(tarsus_Intercept)                     0.48      0.05     0.39     0.59 1.00      840
sd(back_Intercept)                       0.25      0.08     0.10     0.40 1.01      280
cor(tarsus_Intercept,back_Intercept)    -0.52      0.22    -0.94    -0.09 1.00      512
                                     Tail_ESS
sd(tarsus_Intercept)                     1115
sd(back_Intercept)                        621
cor(tarsus_Intercept,back_Intercept)      784

~fosternest (Number of levels: 104) 
                                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(tarsus_Intercept)                     0.27      0.05     0.16     0.37 1.00      589
sd(back_Intercept)                       0.35      0.06     0.23     0.46 1.00      518
cor(tarsus_Intercept,back_Intercept)     0.71      0.20     0.25     0.99 1.00      248
                                     Tail_ESS
sd(tarsus_Intercept)                     1154
sd(back_Intercept)                        822
cor(tarsus_Intercept,back_Intercept)      491

Regression Coefficients:
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
tarsus_Intercept    -0.41      0.07    -0.54    -0.27 1.00     1412     1537
back_Intercept      -0.01      0.06    -0.14     0.11 1.00     2190     1410
tarsus_sexMale       0.77      0.06     0.65     0.89 1.01     3559      871
tarsus_sexUNK        0.23      0.13    -0.02     0.48 1.00     3676     1425
tarsus_hatchdate    -0.04      0.06    -0.16     0.07 1.00     1306     1234
back_sexMale         0.01      0.07    -0.13     0.14 1.00     3812     1497
back_sexUNK          0.15      0.16    -0.16     0.46 1.00     3625     1291
back_hatchdate      -0.09      0.05    -0.19     0.01 1.00     1930     1469

Further Distributional Parameters:
             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_tarsus     0.76      0.02     0.72     0.80 1.00     2288     1290
sigma_back       0.90      0.02     0.86     0.95 1.00     2997     1525

Residual Correlations: 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
rescor(tarsus,back)    -0.05      0.04    -0.13     0.02 1.00     3262     1442

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The summary output of multivariate models closely resembles those of
univariate models, except that the parameters now have the corresponding
response variable as prefix. Across dams, tarsus length and back color
seem to be negatively correlated, while across fosternests the opposite
is true. This indicates differential effects of genetic and
environmental factors on these two characteristics. Further, the small
residual correlation <code>rescor(tarsus, back)</code> on the bottom of
the output indicates that there is little unmodeled dependency between
tarsus length and back color. Although not necessary at this point, we
have already computed and stored the LOO information criterion of
<code>fit1</code>, which we will use for model comparisons. Next, let’s
take a look at some posterior-predictive checks, which give us a first
impression of the model fit.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.brmsfit.html">pp_check</a></span><span class="op">(</span><span class="va">fit1</span>, resp <span class="op">=</span> <span class="st">"tarsus"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_multivariate_files/figure-html/pp_check1-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.brmsfit.html">pp_check</a></span><span class="op">(</span><span class="va">fit1</span>, resp <span class="op">=</span> <span class="st">"back"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_multivariate_files/figure-html/pp_check1-2.png" width="60%" style="display: block; margin: auto;"></p>
<p>This looks pretty solid, but we notice a slight unmodeled left
skewness in the distribution of <code>tarsus</code>. We will come back
to this later on. Next, we want to investigate how much variation in the
response variables can be explained by our model and we use a Bayesian
generalization of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
coefficient.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bayes_R2.brmsfit.html">bayes_R2</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
<pre><code>          Estimate  Est.Error      Q2.5     Q97.5
R2tarsus 0.4339714 0.02341032 0.3861391 0.4784598
R2back   0.1981148 0.02770076 0.1436043 0.2522732</code></pre>
<p>Clearly, there is much variation in both animal characteristics that
we can not explain, but apparently we can explain more of the variation
in tarsus length than in back color.</p>
</div>
<div class="section level2">
<h2 id="more-complex-multivariate-models">More Complex Multivariate Models<a class="anchor" aria-label="anchor" href="#more-complex-multivariate-models"></a>
</h2>
<p>Now, suppose we only want to control for <code>sex</code> in
<code>tarsus</code> but not in <code>back</code> and vice versa for
<code>hatchdate</code>. Not that this is particular reasonable for the
present example, but it allows us to illustrate how to specify different
formulas for different response variables. We can no longer use
<code>mvbind</code> syntax and so we have to use a more verbose
approach:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bf_tarsus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">tarsus</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">p</span><span class="op">|</span><span class="va">fosternest</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">q</span><span class="op">|</span><span class="va">dam</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bf_back</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">back</span> <span class="op">~</span> <span class="va">hatchdate</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">p</span><span class="op">|</span><span class="va">fosternest</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">q</span><span class="op">|</span><span class="va">dam</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm.html">brm</a></span><span class="op">(</span><span class="va">bf_tarsus</span> <span class="op">+</span> <span class="va">bf_back</span> <span class="op">+</span> <span class="fu"><a href="../reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">BTdata</span>, chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Note that we have literally <em>added</em> the two model parts via
the <code>+</code> operator, which is in this case equivalent to writing
<code>mvbf(bf_tarsus, bf_back)</code>. See
<code><a href="../reference/brmsformula.html">help("brmsformula")</a></code> and <code><a href="../reference/mvbrmsformula.html">help("mvbrmsformula")</a></code>
for more details about this syntax. Again, we summarize the model
first.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_criterion.html">add_criterion</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="st">"loo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: tarsus ~ sex + (1 | p | fosternest) + (1 | q | dam) 
         back ~ hatchdate + (1 | p | fosternest) + (1 | q | dam) 
   Data: BTdata (Number of observations: 828) 
  Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 2000

Multilevel Hyperparameters:
~dam (Number of levels: 106) 
                                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(tarsus_Intercept)                     0.48      0.05     0.39     0.58 1.00      671
sd(back_Intercept)                       0.25      0.08     0.11     0.40 1.01      288
cor(tarsus_Intercept,back_Intercept)    -0.48      0.22    -0.89    -0.04 1.00      342
                                     Tail_ESS
sd(tarsus_Intercept)                     1178
sd(back_Intercept)                        854
cor(tarsus_Intercept,back_Intercept)      496

~fosternest (Number of levels: 104) 
                                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(tarsus_Intercept)                     0.27      0.05     0.16     0.37 1.00      482
sd(back_Intercept)                       0.34      0.06     0.23     0.46 1.01      438
cor(tarsus_Intercept,back_Intercept)     0.66      0.23     0.16     0.98 1.00      104
                                     Tail_ESS
sd(tarsus_Intercept)                      986
sd(back_Intercept)                        638
cor(tarsus_Intercept,back_Intercept)      454

Regression Coefficients:
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
tarsus_Intercept    -0.41      0.07    -0.55    -0.27 1.00      956     1045
back_Intercept       0.00      0.05    -0.10     0.11 1.00     1361     1362
tarsus_sexMale       0.77      0.06     0.66     0.89 1.00     2619     1547
tarsus_sexUNK        0.22      0.13    -0.02     0.48 1.00     2120     1330
back_hatchdate      -0.09      0.05    -0.19     0.02 1.00     1438     1359

Further Distributional Parameters:
             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_tarsus     0.76      0.02     0.72     0.80 1.00     1428     1390
sigma_back       0.90      0.02     0.85     0.95 1.00     1617     1461

Residual Correlations: 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
rescor(tarsus,back)    -0.05      0.04    -0.13     0.02 1.00     1720     1560

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Let’s find out, how model fit changed due to excluding certain
effects from the initial model:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loo.brmsfit.html">loo</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<pre><code>Output of model 'fit1':

Computed from 2000 by 828 log-likelihood matrix.

         Estimate   SE
elpd_loo  -2127.6 33.7
p_loo       176.8  7.4
looic      4255.3 67.3
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 2.0]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     826   99.8%   148     
   (0.7, 1]   (bad)        2    0.2%   &lt;NA&gt;    
   (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.

Output of model 'fit2':

Computed from 2000 by 828 log-likelihood matrix.

         Estimate   SE
elpd_loo  -2123.8 33.6
p_loo       174.4  7.4
looic      4247.7 67.2
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.6]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     825   99.6%   134     
   (0.7, 1]   (bad)        3    0.4%   &lt;NA&gt;    
   (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.

Model comparisons:
     elpd_diff se_diff
fit2  0.0       0.0   
fit1 -3.8       1.3   </code></pre>
<p>Apparently, there is no noteworthy difference in the model fit.
Accordingly, we do not really need to model <code>sex</code> and
<code>hatchdate</code> for both response variables, but there is also no
harm in including them (so I would probably just include them).</p>
<p>To give you a glimpse of the capabilities of <strong>brms</strong>’
multivariate syntax, we change our model in various directions at the
same time. Remember the slight left skewness of <code>tarsus</code>,
which we will now model by using the <code>skew_normal</code> family
instead of the <code>gaussian</code> family. Since we do not have a
multivariate normal (or student-t) model, anymore, estimating residual
correlations is no longer possible. We make this explicit using the
<code>set_rescor</code> function. Further, we investigate if the
relationship of <code>back</code> and <code>hatchdate</code> is really
linear as previously assumed by fitting a non-linear spline of
<code>hatchdate</code>. On top of it, we model separate residual
variances of <code>tarsus</code> for male and female chicks.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bf_tarsus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">tarsus</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">p</span><span class="op">|</span><span class="va">fosternest</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">q</span><span class="op">|</span><span class="va">dam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/brmsformula-helpers.html">lf</a></span><span class="op">(</span><span class="va">sigma</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/brmsfamily.html">skew_normal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bf_back</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">back</span> <span class="op">~</span> <span class="fu"><a href="../reference/s.html">s</a></span><span class="op">(</span><span class="va">hatchdate</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">p</span><span class="op">|</span><span class="va">fosternest</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">q</span><span class="op">|</span><span class="va">dam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm.html">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">bf_tarsus</span> <span class="op">+</span> <span class="va">bf_back</span> <span class="op">+</span> <span class="fu"><a href="../reference/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">BTdata</span>, chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Again, we summarize the model and look at some posterior-predictive
checks.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_criterion.html">add_criterion</a></span><span class="op">(</span><span class="va">fit3</span>, <span class="st">"loo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span></span></code></pre></div>
<pre><code> Family: MV(skew_normal, gaussian) 
  Links: mu = identity; sigma = log; alpha = identity
         mu = identity; sigma = identity 
Formula: tarsus ~ sex + (1 | p | fosternest) + (1 | q | dam) 
         sigma ~ 0 + sex
         back ~ s(hatchdate) + (1 | p | fosternest) + (1 | q | dam) 
   Data: BTdata (Number of observations: 828) 
  Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 2000

Smoothing Spline Hyperparameters:
                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sds(back_shatchdate_1)     2.03      1.05     0.47     4.56 1.01      480      520

Multilevel Hyperparameters:
~dam (Number of levels: 106) 
                                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(tarsus_Intercept)                     0.48      0.05     0.38     0.58 1.01      529
sd(back_Intercept)                       0.24      0.07     0.10     0.36 1.00      395
cor(tarsus_Intercept,back_Intercept)    -0.52      0.22    -0.94    -0.06 1.00      344
                                     Tail_ESS
sd(tarsus_Intercept)                      954
sd(back_Intercept)                        571
cor(tarsus_Intercept,back_Intercept)      542

~fosternest (Number of levels: 104) 
                                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(tarsus_Intercept)                     0.27      0.05     0.17     0.37 1.00      555
sd(back_Intercept)                       0.31      0.06     0.20     0.42 1.00      632
cor(tarsus_Intercept,back_Intercept)     0.64      0.21     0.18     0.97 1.00      224
                                     Tail_ESS
sd(tarsus_Intercept)                     1011
sd(back_Intercept)                        738
cor(tarsus_Intercept,back_Intercept)      406

Regression Coefficients:
                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
tarsus_Intercept        -0.41      0.07    -0.54    -0.27 1.00      558     1103
back_Intercept          -0.00      0.05    -0.10     0.10 1.00     1301     1280
tarsus_sexMale           0.77      0.06     0.67     0.87 1.00     2773     1632
tarsus_sexUNK            0.22      0.12    -0.01     0.44 1.00     1968     1519
sigma_tarsus_sexFem     -0.30      0.04    -0.39    -0.22 1.00     1976     1418
sigma_tarsus_sexMale    -0.25      0.04    -0.32    -0.17 1.00     2086     1691
sigma_tarsus_sexUNK     -0.40      0.13    -0.64    -0.15 1.00     1895     1464
back_shatchdate_1       -0.10      3.33    -5.88     7.34 1.00      865      754

Further Distributional Parameters:
             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_back       0.90      0.03     0.85     0.95 1.00     1678     1467
alpha_tarsus    -1.19      0.48    -1.88     0.26 1.00      945      465

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We see that the (log) residual standard deviation of
<code>tarsus</code> is somewhat larger for chicks whose sex could not be
identified as compared to male or female chicks. Further, we see from
the negative <code>alpha</code> (skewness) parameter of
<code>tarsus</code> that the residuals are indeed slightly left-skewed.
Lastly, running</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/conditional_effects.brmsfit.html">conditional_effects</a></span><span class="op">(</span><span class="va">fit3</span>, <span class="st">"hatchdate"</span>, resp <span class="op">=</span> <span class="st">"back"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_multivariate_files/figure-html/me3-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>reveals a non-linear relationship of <code>hatchdate</code> on the
<code>back</code> color, which seems to change in waves over the course
of the hatch dates.</p>
<p>There are many more modeling options for multivariate models, which
are not discussed in this vignette. Examples include autocorrelation
structures, Gaussian processes, or explicit non-linear predictors (e.g.,
see <code><a href="../reference/brmsformula.html">help("brmsformula")</a></code> or
<code>vignette("brms_multilevel")</code>). In fact, nearly all the
flexibility of univariate models is retained in multivariate models.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Hadfield JD, Nutall A, Osorio D, Owens IPF (2007). Testing the
phenotypic gambit: phenotypic, genetic and environmental correlations of
colour. <em>Journal of Evolutionary Biology</em>, 20(2), 549-557.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
