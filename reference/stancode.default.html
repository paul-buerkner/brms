<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Stan Code for brms Models — stancode.default • brms</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Stan Code for brms Models — stancode.default"><meta property="og:description" content="Generate Stan code for brms models"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.22.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="http://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred" class="external-link">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
  </ul></li>
<li>
  <a href="http://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/paul-buerkner/brms" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Stan Code for <span class="pkg">brms</span> Models</h1>
    <small class="dont-index">Source: <a href="https://github.com/paul-buerkner/brms/blob/HEAD/R/stancode.R" class="external-link"><code>R/stancode.R</code></a></small>
    <div class="hidden name"><code>stancode.default.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Generate Stan code for <span class="pkg">brms</span> models</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for default</span></span>
<span><span class="fu"><a href="stancode.html">stancode</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  autocor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cov_ranef <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_prior <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  stanvars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stan_funs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  drop_unused_levels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  threads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"brms.threads"</span>, <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  normalize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"brms.normalize"</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  save_model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>An object of class <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code>,
<code><a href="brmsformula.html">brmsformula</a></code>, or <code><a href="mvbrmsformula.html">mvbrmsformula</a></code> (or one that can
be coerced to that classes): A symbolic description of the model to be
fitted. The details of model specification are explained in
<code><a href="brmsformula.html">brmsformula</a></code>.</p></dd>


<dt>data</dt>
<dd><p>An object of class <code>data.frame</code> (or one that can be coerced
to that class) containing data of all variables used in the model.</p></dd>


<dt>family</dt>
<dd><p>A description of the response distribution and link function to
be used in the model. This can be a family function, a call to a family
function or a character string naming the family. Every family function has
a <code>link</code> argument allowing to specify the link function to be applied
on the response variable. If not specified, default links are used. For
details of supported families see <code><a href="brmsfamily.html">brmsfamily</a></code>. By default, a
linear <code>gaussian</code> model is applied. In multivariate models,
<code>family</code> might also be a list of families.</p></dd>


<dt>prior</dt>
<dd><p>One or more <code>brmsprior</code> objects created by
<code><a href="set_prior.html">set_prior</a></code> or related functions and combined using the
<code>c</code> method or the <code>+</code> operator. See also <code><a href="default_prior.default.html">default_prior</a></code>
for more help.</p></dd>


<dt>autocor</dt>
<dd><p>(Deprecated) An optional <code><a href="cor_brms.html">cor_brms</a></code> object
describing the correlation structure within the response variable (i.e.,
the 'autocorrelation'). See the documentation of <code><a href="cor_brms.html">cor_brms</a></code> for
a description of the available correlation structures. Defaults to
<code>NULL</code>, corresponding to no correlations. In multivariate models,
<code>autocor</code> might also be a list of autocorrelation structures.
It is now recommend to specify autocorrelation terms directly
within <code>formula</code>. See <code><a href="brmsformula.html">brmsformula</a></code> for more details.</p></dd>


<dt>data2</dt>
<dd><p>A named <code>list</code> of objects containing data, which
cannot be passed via argument <code>data</code>. Required for some objects
used in autocorrelation structures to specify dependency structures
as well as for within-group covariance matrices.</p></dd>


<dt>cov_ranef</dt>
<dd><p>(Deprecated) A list of matrices that are proportional to the
(within) covariance structure of the group-level effects. The names of the
matrices should correspond to columns in <code>data</code> that are used as
grouping factors. All levels of the grouping factor should appear as
rownames of the corresponding matrix. This argument can be used, among
others to model pedigrees and phylogenetic effects.
It is now recommended to specify those matrices in the formula
interface using the <code><a href="gr.html">gr</a></code> and related functions. See
<code><a href="../articles/brms_phylogenetics.html">vignette("brms_phylogenetics")</a></code> for more details.</p></dd>


<dt>sparse</dt>
<dd><p>(Deprecated) Logical; indicates whether the population-level
design matrices should be treated as sparse (defaults to <code>FALSE</code>). For
design matrices with many zeros, this can considerably reduce required
memory. Sampling speed is currently not improved or even slightly
decreased. It is now recommended to use the <code>sparse</code> argument of
<code><a href="brmsformula.html">brmsformula</a></code> and related functions.</p></dd>


<dt>sample_prior</dt>
<dd><p>Indicate if draws from priors should be drawn
additionally to the posterior draws. Options are <code>"no"</code> (the
default), <code>"yes"</code>, and <code>"only"</code>. Among others, these draws can
be used to calculate Bayes factors for point hypotheses via
<code><a href="hypothesis.brmsfit.html">hypothesis</a></code>. Please note that improper priors are not sampled,
including the default improper priors used by <code>brm</code>. See
<code><a href="set_prior.html">set_prior</a></code> on how to set (proper) priors. Please also note
that prior draws for the overall intercept are not obtained by default
for technical reasons. See <code><a href="brmsformula.html">brmsformula</a></code> how to obtain prior
draws for the intercept. If <code>sample_prior</code> is set to <code>"only"</code>,
draws are drawn solely from the priors ignoring the likelihood, which
allows among others to generate draws from the prior predictive
distribution. In this case, all parameters must have proper priors.</p></dd>


<dt>stanvars</dt>
<dd><p>An optional <code>stanvars</code> object generated by function
<code><a href="stanvar.html">stanvar</a></code> to define additional variables for use in
<span class="pkg">Stan</span>'s program blocks.</p></dd>


<dt>stan_funs</dt>
<dd><p>(Deprecated) An optional character string containing
self-defined  <span class="pkg">Stan</span> functions, which will be included in the functions
block of the generated <span class="pkg">Stan</span> code. It is now recommended to use the
<code>stanvars</code> argument for this purpose instead.</p></dd>


<dt>knots</dt>
<dd><p>Optional list containing user specified knot values to be used
for basis construction of smoothing terms. See
<code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm</a></code> for more details.</p></dd>


<dt>drop_unused_levels</dt>
<dd><p>Should unused factors levels in the data be
dropped? Defaults to <code>TRUE</code>.</p></dd>


<dt>threads</dt>
<dd><p>Number of threads to use in within-chain parallelization. For
more control over the threading process, <code>threads</code> may also be a
<code>brmsthreads</code> object created by <code><a href="threading.html">threading</a></code>. Within-chain
parallelization is experimental! We recommend its use only if you are
experienced with Stan's <code>reduce_sum</code> function and have a slow running
model that cannot be sped up by any other means. Can be set globally for
the current <span style="R">R</span> session via the <code>"brms.threads"</code> option (see
<code><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></code>).</p></dd>


<dt>normalize</dt>
<dd><p>Logical. Indicates whether normalization constants should
be included in the Stan code (defaults to <code>TRUE</code>). Setting it
to <code>FALSE</code> requires Stan version &gt;= 2.25 to work. If <code>FALSE</code>,
sampling efficiency may be increased but some post processing functions
such as <code><a href="bridge_sampler.brmsfit.html">bridge_sampler</a></code> will not be available. Can be
controlled globally for the current <span style="R">R</span> session via the `brms.normalize`
option.</p></dd>


<dt>save_model</dt>
<dd><p>Either <code>NULL</code> or a character string. In the latter
case, the model's Stan code is saved via <code><a href="addition-terms.html">cat</a></code> in a text file
named after the string supplied in <code>save_model</code>.</p></dd>


<dt>...</dt>
<dd><p>Other arguments for internal usage only.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A character string containing the fully commented <span class="pkg">Stan</span> code
  to fit a <span class="pkg">brms</span> model. It is of class <code>c("character", "brmsmodel")</code></p>


<p>to facilitate pretty printing.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="stancode.html">stancode</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">treat</span> <span class="op">+</span> <span class="va">period</span> <span class="op">+</span> <span class="va">carry</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">subject</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         data <span class="op">=</span> <span class="va">inhaler</span>, family <span class="op">=</span> <span class="st">"cumulative"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> // generated with brms 2.22.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> functions {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   /* cumulative-logit log-PDF for a single response</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    * Args:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   y: response category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   mu: latent mean parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   disc: discrimination parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   thres: ordinal thresholds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    * Returns:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   a scalar to be added to the log posterior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    */</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    real cumulative_logit_lpmf(int y, real mu, real disc, vector thres) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      int nthres = num_elements(thres);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      if (y == 1) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        return log_inv_logit(disc * (thres[1] - mu));</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      } else if (y == nthres + 1) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        return log1m_inv_logit(disc * (thres[nthres] - mu));</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      } else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        return log_inv_logit_diff(disc * (thres[y] - mu), disc * (thres[y - 1] - mu));</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   /* cumulative-logit log-PDF for a single response and merged thresholds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    * Args:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   y: response category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   mu: latent mean parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   disc: discrimination parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   thres: vector of merged ordinal thresholds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   j: start and end index for the applid threshold within 'thres'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    * Returns:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   a scalar to be added to the log posterior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    */</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    real cumulative_logit_merged_lpmf(int y, real mu, real disc, vector thres, array[] int j) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      return cumulative_logit_lpmf(y | mu, disc, thres[j[1]:j[2]]);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   /* ordered-logistic log-PDF for a single response and merged thresholds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    * Args:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   y: response category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   mu: latent mean parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   thres: vector of merged ordinal thresholds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   j: start and end index for the applid threshold within 'thres'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    * Returns:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    *   a scalar to be added to the log posterior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    */</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    real ordered_logistic_merged_lpmf(int y, real mu, vector thres, array[] int j) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      return ordered_logistic_lpmf(y | mu, thres[j[1]:j[2]]);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; N;  // total number of observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[N] int Y;  // response variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=2&gt; nthres;  // number of thresholds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; K;  // number of population-level effects</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   matrix[N, K] X;  // population-level design matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; Kc;  // number of population-level effects after centering</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // data for group-level effects of ID 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; N_1;  // number of grouping levels</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; M_1;  // number of coefficients per level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[N] int&lt;lower=1&gt; J_1;  // grouping indicator per observation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // group-level predictor values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[N] Z_1_1;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int prior_only;  // should the likelihood be ignored?</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> transformed data {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   matrix[N, Kc] Xc;  // centered version of X</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[Kc] means_X;  // column means of X before centering</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:K) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     means_X[i] = mean(X[, i]);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Xc[, i] = X[, i] - means_X[i];</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parameters {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[Kc] b;  // regression coefficients</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ordered[nthres] Intercept;  // temporary thresholds for centered predictors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector&lt;lower=0&gt;[M_1] sd_1;  // group-level standard deviations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[M_1] vector[N_1] z_1;  // standardized group-level effects</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> transformed parameters {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real disc = 1;  // discrimination parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[N_1] r_1_1;  // actual group-level effects</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real lprior = 0;  // prior contributions to the log posterior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   r_1_1 = (sd_1[1] * (z_1[1]));</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lprior += student_t_lpdf(Intercept | 3, 0, 2.5);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lprior += student_t_lpdf(sd_1 | 3, 0, 2.5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - 1 * student_t_lccdf(0 | 3, 0, 2.5);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // likelihood including constants</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   if (!prior_only) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // initialize linear predictor term</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vector[N] mu = rep_vector(0.0, N);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     mu += Xc * b;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (n in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       // add more terms to the linear predictor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mu[n] += r_1_1[J_1[n]] * Z_1_1[n];</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (n in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       target += ordered_logistic_lpmf(Y[n] | mu[n], Intercept);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // priors including constants</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   target += lprior;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   target += std_normal_lpdf(z_1[1]);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> generated quantities {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // compute actual thresholds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[nthres] b_Intercept = Intercept + dot_product(means_X, b);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="stancode.html">stancode</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">zAge</span> <span class="op">+</span> <span class="va">zBase</span> <span class="op">*</span> <span class="va">Trt</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         data <span class="op">=</span> <span class="va">epilepsy</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> // generated with brms 2.22.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> functions {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; N;  // total number of observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[N] int Y;  // response variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; K;  // number of population-level effects</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   matrix[N, K] X;  // population-level design matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; Kc;  // number of population-level effects after centering</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // data for group-level effects of ID 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; N_1;  // number of grouping levels</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; M_1;  // number of coefficients per level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[N] int&lt;lower=1&gt; J_1;  // grouping indicator per observation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // group-level predictor values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[N] Z_1_1;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int prior_only;  // should the likelihood be ignored?</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> transformed data {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   matrix[N, Kc] Xc;  // centered version of X without an intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[Kc] means_X;  // column means of X before centering</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 2:K) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     means_X[i - 1] = mean(X[, i]);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Xc[, i - 1] = X[, i] - means_X[i - 1];</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parameters {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[Kc] b;  // regression coefficients</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real Intercept;  // temporary intercept for centered predictors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector&lt;lower=0&gt;[M_1] sd_1;  // group-level standard deviations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[M_1] vector[N_1] z_1;  // standardized group-level effects</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> transformed parameters {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[N_1] r_1_1;  // actual group-level effects</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real lprior = 0;  // prior contributions to the log posterior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   r_1_1 = (sd_1[1] * (z_1[1]));</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lprior += student_t_lpdf(Intercept | 3, 1.4, 2.5);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lprior += student_t_lpdf(sd_1 | 3, 0, 2.5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - 1 * student_t_lccdf(0 | 3, 0, 2.5);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // likelihood including constants</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   if (!prior_only) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     // initialize linear predictor term</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vector[N] mu = rep_vector(0.0, N);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     mu += Intercept;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (n in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       // add more terms to the linear predictor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mu[n] += r_1_1[J_1[n]] * Z_1_1[n];</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     target += poisson_log_glm_lpmf(Y | Xc, mu, b);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // priors including constants</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   target += lprior;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   target += std_normal_lpdf(z_1[1]);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> generated quantities {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   // actual population-level intercept</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real b_Intercept = Intercept - dot_product(means_X, b);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

